<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VÃ­cios Digitais: GamificaÃ§Ã£o e ConscientizaÃ§Ã£o</title>
    <meta name="description" content="Explore os mecanismos psicolÃ³gicos e a gamificaÃ§Ã£o por trÃ¡s dos vÃ­cios digitais. Ganhe pontos, badges e celebre seu progresso!">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Reset BÃ¡sico */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --primary-color: #6a0dad; /* Roxo */
            --secondary-color: #00bcd4; /* Ciano */
            --accent-color: #ffeb3b; /* Amarelo */
            --text-color: #333;
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --border-radius: 8px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --celebration-duration: 3s;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-x: hidden; /* Previne scroll horizontal devido a partÃ­culas */
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            text-align: center;
            box-shadow: var(--shadow);
            z-index: 100;
        }

        header h1 {
            margin-bottom: 0.5rem;
            font-size: 2.5rem;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        main {
            flex-grow: 1;
            padding: 2rem;
            max-width: 1200px;
            margin: 2rem auto;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 2rem;
            align-items: start;
        }

        @media (max-width: 992px) {
            main {
                grid-template-columns: 1fr;
                padding: 1rem;
            }
            .sidebar {
                order: -1; /* Move sidebar to top on smaller screens */
            }
        }

        .content-area {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .content-area h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            font-size: 2rem;
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 0.5rem;
        }

        .content-area p {
            margin-bottom: 1rem;
        }

        .content-area button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-top: 1rem;
        }

        .content-area button:hover {
            background-color: #00a0b8;
            transform: translateY(-2px);
        }

        .content-area button:active {
            transform: translateY(0);
        }

        .sidebar {
            background-color: var(--card-bg);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            position: sticky;
            top: 2rem; /* Stick to top of viewport */
        }

        .sidebar h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-size: 1.5rem;
            border-bottom: 1px solid var(--secondary-color);
            padding-bottom: 0.5rem;
        }

        .gamification-stats p {
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .gamification-stats strong {
            color: var(--secondary-color);
        }

        .progress-bar-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin-top: 1rem;
            height: 15px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--accent-color);
            border-radius: 5px;
            transition: width 0.5s ease-out;
        }

        .badges-list {
            list-style: none;
            padding: 0;
            margin-top: 1rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .badge-item {
            background-color: #eee;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #666;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .badge-item.unlocked {
            background-color: var(--secondary-color);
            color: white;
            font-weight: 600;
        }

        .badge-item .icon {
            font-size: 1.1rem;
        }

        .daily-challenge {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px dashed #ccc;
        }

        .daily-challenge button {
            width: 100%;
            margin-top: 0.8rem;
        }

        .controls {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px dashed #ccc;
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .controls button {
            background-color: #6c757d;
            width: 100%;
        }

        .controls button:hover {
            background-color: #5a6268;
        }

        .controls .toggle-switch {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .controls .toggle-switch label {
            font-weight: 600;
            color: var(--text-color);
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 20px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--secondary-color);
        }

        input:checked + .slider:before {
            transform: translateX(20px);
        }

        /* Celebration Overlay */
        #celebration-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        #celebration-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .celebration-message {
            font-size: 3.5rem;
            font-weight: 700;
            color: white;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            margin-bottom: 1rem;
            transform: translateY(-50px) scale(0.8);
            opacity: 0;
            animation: messageEnter var(--celebration-duration) cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards;
            animation-delay: 0.2s;
            text-align: center;
        }

        .points-display {
            font-size: 5rem;
            font-weight: 900;
            color: var(--accent-color);
            text-shadow: 0 4px 10px rgba(0, 0, 0, 0.6);
            transform: scale(0.5);
            opacity: 0;
            animation: pointsEnter var(--celebration-duration) cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards;
            animation-delay: 0.5s;
        }

        .particles-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            opacity: 0;
            animation: particleFall var(--celebration-duration) forwards;
            will-change: transform, opacity;
        }

        .particle.confetti {
            width: 10px;
            height: 10px;
            background-color: currentColor;
            border-radius: 50%;
            animation: particleFall var(--celebration-duration) forwards, particleRotate var(--celebration-duration) infinite linear;
        }

        .particle.star {
            font-size: 20px;
            color: var(--accent-color);
            animation: particleFall var(--celebration-duration) forwards, particleTwinkle var(--celebration-duration) infinite alternate;
        }

        .particle.emoji {
            font-size: 24px;
            animation: particleFall var(--celebration-duration) forwards, emojiFloat var(--celebration-duration) infinite alternate;
        }

        /* Keyframe Animations */
        @keyframes messageEnter {
            0% { opacity: 0; transform: translateY(-50px) scale(0.8); }
            30% { opacity: 1; transform: translateY(0) scale(1.1); }
            60% { transform: scale(1); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }

        @keyframes pointsEnter {
            0% { opacity: 0; transform: scale(0.5); }
            40% { opacity: 1; transform: scale(1.2); }
            70% { transform: scale(1); }
            100% { opacity: 1; transform: scale(1); }
        }

        @keyframes particleFall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        @keyframes particleRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes particleTwinkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes emojiFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }

        /* Milestone Modal */
        #milestone-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        #milestone-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--card-bg);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            max-width: 500px;
            transform: scale(0.8);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        #milestone-modal.active .modal-content {
            transform: scale(1);
            opacity: 1;
        }

        .modal-content h3 {
            color: var(--primary-color);
            font-size: 2.2rem;
            margin-bottom: 1rem;
        }

        .modal-content p {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
        }

        .modal-content .points-achieved {
            font-size: 3rem;
            font-weight: 700;
            color: var(--secondary-color);
            margin-bottom: 1.5rem;
        }

        .modal-content button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.8rem 2rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: background-color 0.3s ease;
        }

        .modal-content button:hover {
            background-color: #5a0a9e;
        }

        /* Analytics Dashboard */
        #analytics-dashboard {
            position: fixed;
            top: 0;
            right: -400px; /* Hidden by default */
            width: 350px;
            height: 100%;
            background-color: var(--card-bg);
            box-shadow: -4px 0 12px rgba(0, 0, 0, 0.1);
            z-index: 10001;
            transition: right 0.4s ease-out;
            padding: 2rem;
            overflow-y: auto;
        }

        #analytics-dashboard.active {
            right: 0;
        }

        #analytics-dashboard h3 {
            color: var(--primary-color);
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--secondary-color);
            padding-bottom: 0.5rem;
        }

        #analytics-dashboard p {
            margin-bottom: 0.8rem;
            font-size: 1rem;
        }

        #analytics-dashboard strong {
            color: var(--secondary-color);
        }

        #analytics-dashboard ul {
            list-style: none;
            padding: 0;
            margin-top: 1rem;
        }

        #analytics-dashboard li {
            background-color: #f0f0f0;
            padding: 0.5rem;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #analytics-dashboard .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #666;
            transition: color 0.3s ease;
        }

        #analytics-dashboard .close-btn:hover {
            color: var(--primary-color);
        }

        #analytics-dashboard button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s ease;
            width: 100%;
            margin-top: 1.5rem;
        }

        #analytics-dashboard button:hover {
            background-color: #5a0a9e;
        }

        /* Accessibility: Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
            .celebration-message, .points-display, .particle, .modal-content,
            #celebration-overlay, #milestone-modal, #analytics-dashboard {
                animation: none !important;
                transition: none !important;
            }
            .particle {
                display: none !important; /* Hide particles entirely */
            }
        }

        /* Footer */
        footer {
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            padding: 1rem;
            margin-top: 2rem;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <header>
        <h1>VÃ­cios Digitais: GamificaÃ§Ã£o e ConscientizaÃ§Ã£o</h1>
        <p>Descubra como a tecnologia nos engaja e aprenda a equilibrar sua vida digital.</p>
    </header>

    <main>
        <section class="content-area" id="page-content">
            <h2 id="page-title">PÃ¡gina Inicial: IntroduÃ§Ã£o</h2>
            <p id="page-text">Bem-vindo ao nosso projeto educacional sobre vÃ­cios digitais e os novos padrÃµes comportamentais da sociedade. Aqui, exploraremos como empresas utilizam mecanismos psicolÃ³gicos sofisticados para manter os usuÃ¡rios engajados, muitas vezes sem que percebam.</p>
            <p>Navegue pelas seÃ§Ãµes para entender o sistema dopaminÃ©rgico, os mecanismos psicolÃ³gicos e as ferramentas de estimulaÃ§Ã£o que moldam nossa interaÃ§Ã£o com a tecnologia. Ao explorar o site, vocÃª ganharÃ¡ pontos e desbloquearÃ¡ badges, demonstrando como a gamificaÃ§Ã£o funciona na prÃ¡tica.</p>
            <button id="next-page-btn">Explorar Sistema DopaminÃ©rgico (Ganhe Pontos!)</button>
            <button id="complete-quiz-btn" style="display: none;">Completar Quiz (Ganhe Pontos e Badge!)</button>
        </section>

        <aside class="sidebar">
            <h3>Seu Progresso</h3>
            <div class="gamification-stats">
                <p>Pontos: <strong id="current-points">0</strong></p>
                <p>Multiplicador: <strong id="current-multiplier">x1</strong></p>
                <p>PrÃ³ximo Badge: <strong id="next-badge-info">Nenhum</strong></p>
                <p>PrÃ³ximo Milestone: <strong id="next-milestone-info">Nenhum</strong></p>
            </div>

            <h4>Progresso Geral</h4>
            <div class="progress-bar-container">
                <div class="progress-bar" id="overall-progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
            </div>

            <h4>Badges Desbloqueados</h4>
            <ul class="badges-list" id="unlocked-badges-list">
                <li class="badge-item"><span class="icon">ðŸ”’</span> Visitante</li>
                <li class="badge-item"><span class="icon">ðŸ”’</span> Explorador</li>
                <li class="badge-item"><span class="icon">ðŸ”’</span> Mestre</li>
                <li class="badge-item"><span class="icon">ðŸ”’</span> Especialista</li>
                <li class="badge-item"><span class="icon">ðŸ”’</span> Guru</li>
                <li class="badge-item"><span class="icon">ðŸ”’</span> Defensor</li>
                <li class="badge-item"><span class="icon">ðŸ”’</span> Mestre do Quiz</li>
            </ul>

            <div class="daily-challenge">
                <h4>Desafio DiÃ¡rio</h4>
                <p id="daily-challenge-text">Visite 3 pÃ¡ginas para ganhar 50 pontos bÃ´nus!</p>
                <button id="complete-daily-challenge-btn" disabled>Completar Desafio DiÃ¡rio</button>
            </div>

            <div class="controls">
                <h4>ConfiguraÃ§Ãµes & Ferramentas</h4>
                <div class="toggle-switch">
                    <label for="sound-toggle">Som de CelebraÃ§Ã£o</label>
                    <label class="switch">
                        <input type="checkbox" id="sound-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="toggle-switch">
                    <label for="vibration-toggle">VibraÃ§Ã£o (Celular)</label>
                    <label class="switch">
                        <input type="checkbox" id="vibration-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <button id="show-analytics-btn">Ver Dashboard de Analytics</button>
                <button id="reset-game-btn" style="background-color: #dc3545;">Reiniciar Jogo</button>
            </div>
        </aside>
    </main>

    <footer>
        <p>&copy; 2023 Projeto Educacional: VÃ­cios Digitais. Todos os direitos reservados.</p>
    </footer>

    <!-- Celebration Overlay -->
    <div id="celebration-overlay" aria-live="polite" aria-atomic="true">
        <div class="celebration-message" role="status"></div>
        <div class="points-display" role="status"></div>
        <div class="particles-container"></div>
    </div>

    <!-- Milestone Modal -->
    <div id="milestone-modal" role="dialog" aria-modal="true" aria-labelledby="milestone-modal-title" aria-describedby="milestone-modal-description">
        <div class="modal-content">
            <h3 id="milestone-modal-title">ðŸŽ‰ Milestone AlcanÃ§ado! ðŸŽ‰</h3>
            <p id="milestone-modal-description">VocÃª atingiu um novo marco em sua jornada!</p>
            <div class="points-achieved" id="milestone-modal-points"></div>
            <button id="close-milestone-modal">Continuar</button>
        </div>
    </div>

    <!-- Analytics Dashboard -->
    <div id="analytics-dashboard" role="complementary" aria-labelledby="analytics-dashboard-title">
        <button class="close-btn" id="close-analytics-btn" aria-label="Fechar Dashboard">&times;</button>
        <h3 id="analytics-dashboard-title">Dashboard de Analytics</h3>
        <p>Total de Pontos Ganhos: <strong id="analytics-total-points">0</strong></p>
        <p>Badges Desbloqueados: <strong id="analytics-badges-unlocked">0</strong> / 7</p>
        <p>Milestones AlcanÃ§ados: <strong id="analytics-milestones-achieved">0</strong> / 5</p>
        <p>Tempo de SessÃ£o: <strong id="analytics-session-time">0s</strong></p>
        <h4>Eventos Mais Celebrados:</h4>
        <ul id="analytics-most-celebrated">
            <li>Nenhum evento registrado ainda.</li>
        </ul>
        <button id="export-analytics-btn">Exportar Dados (JSON)</button>
    </div>

    <script>
        // ====================================================================================================
        // JAVASCRIPT MODULAR
        // ====================================================================================================

        // --- 1. AnalyticsTracker Module ---
        // Gerencia o registro e a exportaÃ§Ã£o de eventos de usuÃ¡rio e mÃ©tricas de engajamento.
        const AnalyticsTracker = (() => {
            let events = [];
            let sessionStartTime = Date.now();
            const STORAGE_KEY = 'gamification_analytics';

            /**
             * Carrega eventos salvos do localStorage.
             */
            const loadEvents = () => {
                const storedEvents = localStorage.getItem(STORAGE_KEY);
                if (storedEvents) {
                    events = JSON.parse(storedEvents);
                }
            };

            /**
             * Salva os eventos atuais no localStorage.
             */
            const saveEvents = () => {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(events));
            };

            /**
             * Registra um novo evento.
             * @param {string} eventName - Nome do evento (ex: 'pointsEarned', 'badgeUnlocked').
             * @param {object} data - Dados adicionais do evento.
             */
            const track = (eventName, data = {}) => {
                const event = {
                    timestamp: Date.now(),
                    eventName,
                    ...data
                };
                events.push(event);
                saveEvents();
                // console.log('Analytics Tracked:', event);
            };

            /**
             * Calcula e retorna mÃ©tricas de engajamento.
             * @returns {object} Objeto com as mÃ©tricas calculadas.
             */
            const getMetrics = () => {
                const totalPoints = events.filter(e => e.eventName === 'pointsEarned').reduce((sum, e) => sum + (e.points || 0), 0);
                const badgesUnlocked = new Set(events.filter(e => e.eventName === 'badgeUnlocked').map(e => e.badgeId)).size;
                const milestonesAchieved = new Set(events.filter(e => e.eventName === 'milestoneAchieved').map(e => e.milestoneId)).size;
                const sessionDuration = Math.floor((Date.now() - sessionStartTime) / 1000); // em segundos

                const eventCounts = events.reduce((acc, event) => {
                    acc[event.eventName] = (acc[event.eventName] || 0) + 1;
                    return acc;
                }, {});

                const sortedEvents = Object.entries(eventCounts).sort(([, countA], [, countB]) => countB - countA);
                const mostCelebrated = sortedEvents.slice(0, 3).map(([name, count]) => `${name} (${count}x)`);

                return {
                    totalPoints,
                    badgesUnlocked,
                    milestonesAchieved,
                    sessionDuration,
                    mostCelebrated
                };
            };

            /**
             * Exporta todos os dados de eventos como uma string JSON.
             * @returns {string} String JSON dos eventos.
             */
            const exportData = () => {
                return JSON.stringify(events, null, 2);
            };

            /**
             * Reseta todos os dados de analytics.
             */
            const reset = () => {
                events = [];
                sessionStartTime = Date.now();
                localStorage.removeItem(STORAGE_KEY);
                track('analyticsReset');
            };

            // Inicializa ao carregar o mÃ³dulo
            loadEvents();
            track('sessionStart');

            return {
                track,
                getMetrics,
                exportData,
                reset
            };
        })();

        // --- 2. GamificationManager Module ---
        // Gerencia o estado do jogo (pontos, badges, milestones, desafios diÃ¡rios) e emite eventos.
        const GamificationManager = (() => {
            let state = {
                points: 0,
                badges: [], // Array de IDs de badges desbloqueados
                milestones: {}, // { milestoneId: true } para milestones alcanÃ§ados
                dailyChallenge: {
                    completed: false,
                    pagesVisitedToday: 0
                },
                multiplier: 1,
                lastDailyReset: new Date().toDateString() // Para resetar o desafio diÃ¡rio
            };

            // ConfiguraÃ§Ãµes de Badges
            const badgesConfig = [
                { id: 'visitor', name: 'Visitante', threshold: 1, celebrationType: 'points', icon: 'ðŸ‘‹' },
                { id: 'explorer', name: 'Explorador', threshold: 50, celebrationType: 'badge', icon: 'ðŸ§­' },
                { id: 'master', name: 'Mestre', threshold: 150, celebrationType: 'badge', icon: 'ðŸ†' },
                { id: 'specialist', name: 'Especialista', threshold: 300, celebrationType: 'badge', icon: 'ðŸ§ ' },
                { id: 'guru', name: 'Guru', threshold: 500, celebrationType: 'badge', icon: 'ðŸ§˜' },
                { id: 'defender', name: 'Defensor', threshold: 750, celebrationType: 'badge', icon: 'ðŸ›¡ï¸' },
                { id: 'quiz_master', name: 'Mestre do Quiz', threshold: null, celebrationType: 'badge', icon: 'ðŸŽ“' } // Desbloqueado por aÃ§Ã£o especÃ­fica
            ];

            // ConfiguraÃ§Ãµes de Milestones
            const milestonesConfig = [
                { id: 'm100', threshold: 100, message: 'VocÃª alcanÃ§ou 100 pontos!', celebrationType: 'milestone' },
                { id: 'm250', threshold: 250, message: 'VocÃª alcanÃ§ou 250 pontos!', celebrationType: 'milestone' },
                { id: 'm500', threshold: 500, message: 'VocÃª alcanÃ§ou 500 pontos!', celebrationType: 'milestone' },
                { id: 'm750', threshold: 750, message: 'VocÃª alcanÃ§ou 750 pontos!', celebrationType: 'milestone' },
                { id: 'm1000', threshold: 1000, message: 'VocÃª alcanÃ§ou 1000 pontos! IncrÃ­vel!', celebrationType: 'milestone' }
            ];

            const dailyChallengeConfig = {
                pagesToVisit: 3,
                bonusPoints: 50
            };

            const STORAGE_KEY = 'gamification_state';
            const eventTarget = new EventTarget(); // Para emitir eventos personalizados

            /**
             * Carrega o estado do jogo do localStorage.
             */
            const loadState = () => {
                const storedState = localStorage.getItem(STORAGE_KEY);
                if (storedState) {
                    state = JSON.parse(storedState);
                }
                // Verifica e reseta o desafio diÃ¡rio se a data mudou
                const today = new Date().toDateString();
                if (state.lastDailyReset !== today) {
                    state.dailyChallenge = { completed: false, pagesVisitedToday: 0 };
                    state.lastDailyReset = today;
                    saveState();
                }
            };

            /**
             * Salva o estado atual do jogo no localStorage.
             */
            const saveState = () => {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            };

            /**
             * Adiciona pontos ao jogador, aplicando multiplicadores e verificando desbloqueios.
             * @param {number} baseAmount - Quantidade base de pontos a adicionar.
             * @param {number} [multiplier=1] - Multiplicador adicional para esta aÃ§Ã£o.
             */
            const addPoints = (baseAmount, actionMultiplier = 1) => {
                const actualPoints = baseAmount * state.multiplier * actionMultiplier;
                state.points += actualPoints;
                saveState();
                eventTarget.dispatchEvent(new CustomEvent('pointsEarned', { detail: { points: actualPoints, totalPoints: state.points } }));
                AnalyticsTracker.track('pointsEarned', { points: actualPoints, totalPoints: state.points });
                checkBadges();
                checkMilestones();
            };

            /**
             * Desbloqueia um badge especÃ­fico.
             * @param {string} badgeId - ID do badge a ser desbloqueado.
             */
            const unlockBadge = (badgeId) => {
                if (!state.badges.includes(badgeId)) {
                    state.badges.push(badgeId);
                    saveState();
                    const badge = badgesConfig.find(b => b.id === badgeId);
                    eventTarget.dispatchEvent(new CustomEvent('badgeUnlocked', { detail: { badgeId, badgeName: badge.name, celebrationType: badge.celebrationType } }));
                    AnalyticsTracker.track('badgeUnlocked', { badgeId, badgeName: badge.name });
                }
            };

            /**
             * Verifica se novos badges foram desbloqueados com base nos pontos atuais.
             */
            const checkBadges = () => {
                badgesConfig.forEach(badge => {
                    if (badge.threshold !== null && state.points >= badge.threshold && !state.badges.includes(badge.id)) {
                        unlockBadge(badge.id);
                    }
                });
            };

            /**
             * Verifica se novos milestones foram alcanÃ§ados com base nos pontos atuais.
             */
            const checkMilestones = () => {
                milestonesConfig.forEach(milestone => {
                    if (state.points >= milestone.threshold && !state.milestones[milestone.id]) {
                        state.milestones[milestone.id] = true;
                        saveState();
                        eventTarget.dispatchEvent(new CustomEvent('milestoneAchieved', { detail: { milestoneId: milestone.id, message: milestone.message, points: milestone.threshold, celebrationType: milestone.celebrationType } }));
                        AnalyticsTracker.track('milestoneAchieved', { milestoneId: milestone.id, points: milestone.threshold });
                    }
                });
            };

            /**
             * Incrementa o contador de pÃ¡ginas visitadas para o desafio diÃ¡rio.
             */
            const incrementDailyPagesVisited = () => {
                if (!state.dailyChallenge.completed) {
                    state.dailyChallenge.pagesVisitedToday++;
                    saveState();
                    eventTarget.dispatchEvent(new CustomEvent('dailyProgress', { detail: { current: state.dailyChallenge.pagesVisitedToday, target: dailyChallengeConfig.pagesToVisit } }));
                    if (state.dailyChallenge.pagesVisitedToday >= dailyChallengeConfig.pagesToVisit) {
                        eventTarget.dispatchEvent(new CustomEvent('dailyChallengeReady'));
                    }
                }
            };

            /**
             * Completa o desafio diÃ¡rio, adiciona pontos bÃ´nus e marca como concluÃ­do.
             */
            const completeDailyChallenge = () => {
                if (!state.dailyChallenge.completed && state.dailyChallenge.pagesVisitedToday >= dailyChallengeConfig.pagesToVisit) {
                    state.dailyChallenge.completed = true;
                    addPoints(dailyChallengeConfig.bonusPoints, 1); // Adiciona pontos bÃ´nus sem multiplicador extra
                    saveState();
                    eventTarget.dispatchEvent(new CustomEvent('dailyChallengeCompleted', { detail: { points: dailyChallengeConfig.bonusPoints } }));
                    AnalyticsTracker.track('dailyChallengeCompleted', { points: dailyChallengeConfig.bonusPoints });
                }
            };

            /**
             * Reseta todo o progresso do jogo.
             */
            const resetGame = () => {
                if (confirm('Tem certeza que deseja reiniciar todo o seu progresso? Isso nÃ£o pode ser desfeito.')) {
                    localStorage.removeItem(STORAGE_KEY);
                    AnalyticsTracker.reset(); // Reseta analytics tambÃ©m
                    state = {
                        points: 0,
                        badges: [],
                        milestones: {},
                        dailyChallenge: { completed: false, pagesVisitedToday: 0 },
                        multiplier: 1,
                        lastDailyReset: new Date().toDateString()
                    };
                    saveState();
                    eventTarget.dispatchEvent(new CustomEvent('gameReset'));
                    alert('Jogo reiniciado com sucesso!');
                    window.location.reload(); // Recarrega a pÃ¡gina para refletir o reset
                }
            };

            /**
             * Retorna o prÃ³ximo badge a ser desbloqueado.
             * @returns {object|null} O prÃ³ximo badge ou null se todos foram desbloqueados.
             */
            const getNextBadge = () => {
                const sortedBadges = [...badgesConfig].sort((a, b) => a.threshold - b.threshold);
                for (const badge of sortedBadges) {
                    if (badge.threshold !== null && !state.badges.includes(badge.id)) {
                        return badge;
                    }
                }
                return null;
            };

            /**
             * Retorna o prÃ³ximo milestone a ser alcanÃ§ado.
             * @returns {object|null} O prÃ³ximo milestone ou null se todos foram alcanÃ§ados.
             */
            const getNextMilestone = () => {
                const sortedMilestones = [...milestonesConfig].sort((a, b) => a.threshold - b.threshold);
                for (const milestone of sortedMilestones) {
                    if (!state.milestones[milestone.id]) {
                        return milestone;
                    }
                }
                return null;
            };

            // Inicializa ao carregar o mÃ³dulo
            loadState();
            checkBadges(); // Garante que badges sejam verificados no carregamento

            return {
                init: loadState,
                addPoints,
                unlockBadge,
                completeDailyChallenge,
                incrementDailyPagesVisited,
                resetGame,
                getState: () => ({ ...state }), // Retorna uma cÃ³pia do estado
                getBadgesConfig: () => [...badgesConfig],
                getDailyChallengeConfig: () => ({ ...dailyChallengeConfig }),
                getNextBadge,
                getNextMilestone,
                addEventListener: eventTarget.addEventListener.bind(eventTarget),
                removeEventListener: eventTarget.removeEventListener.bind(eventTarget)
            };
        })();

        // --- 3. CelebrationAnimation Module ---
        // Gerencia a exibiÃ§Ã£o de animaÃ§Ãµes visuais de celebraÃ§Ã£o.
        const CelebrationAnimation = (() => {
            const overlay = document.getElementById('celebration-overlay');
            const messageEl = overlay.querySelector('.celebration-message');
            const pointsEl = overlay.querySelector('.points-display');
            const particlesContainer = overlay.querySelector('.particles-container');
            const milestoneModal = document.getElementById('milestone-modal');
            const milestoneModalTitle = document.getElementById('milestone-modal-title');
            const milestoneModalDescription = document.getElementById('milestone-modal-description');
            const milestoneModalPoints = document.getElementById('milestone-modal-points');
            const closeMilestoneModalBtn = document.getElementById('close-milestone-modal');

            let animationTimeout;
            let currentParticles = [];
            const animationDuration = 3000; // DuraÃ§Ã£o total da animaÃ§Ã£o em ms

            // Sons de celebraÃ§Ã£o (placeholders)
            const sounds = {
                points: new Audio('https://www.soundjay.com/buttons/sounds/button-3.mp3'), // Som de clique/ponto
                badge: new Audio('https://www.soundjay.com/misc/sounds/magic-chime-01.mp3'), // Som de magia/chime
                milestone: new Audio('https://www.soundjay.com/misc/sounds/success-fanfare-01.mp3'), // Som de fanfarra
                default: new Audio('https://www.soundjay.com/misc/sounds/ding-dong-01.mp3') // Som padrÃ£o
            };

            /**
             * Toca um som de celebraÃ§Ã£o.
             * @param {string} type - Tipo de celebraÃ§Ã£o para escolher o som.
             */
            const playSound = (type) => {
                if (document.getElementById('sound-toggle').checked) {
                    const sound = sounds[type] || sounds.default;
                    sound.currentTime = 0; // Reinicia o som se jÃ¡ estiver tocando
                    sound.play().catch(e => console.warn("Erro ao tocar som:", e));
                }
            };

            /**
             * Aciona vibraÃ§Ã£o no dispositivo (se suportado).
             */
            const vibrate = () => {
                if (document.getElementById('vibration-toggle').checked && navigator.vibrate) {
                    navigator.vibrate(200); // Vibra por 200ms
                }
            };

            /**
             * Cria e adiciona partÃ­culas de celebraÃ§Ã£o ao DOM.
             * @param {string} type - Tipo de partÃ­cula ('confetti', 'stars', 'emojis').
             * @param {number} count - NÃºmero de partÃ­culas a criar.
             */
            const createParticles = (type, count) => {
                const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4CAF50', '#8BC34A', '#CDDC39', '#FFEB3B', '#FFC107', '#FF9800', '#FF5722'];
                const emojis = ['ðŸŽ‰', 'âœ¨', 'ðŸŒŸ', 'ðŸ¥³', 'ðŸš€', 'ðŸ’–', 'ðŸ’¯', 'ðŸ¤©', 'ðŸ’«'];
                const particleCount = window.innerWidth < 768 ? Math.floor(count / 2) : count; // Menos partÃ­culas em mobile

                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.classList.add('particle', type);
                    particle.style.left = `${Math.random() * 100}vw`;
                    particle.style.top = `${Math.random() * 100}vh`;
                    particle.style.animationDelay = `${Math.random() * 0.5}s`; // Pequeno delay para variaÃ§Ã£o

                    if (type === 'confetti') {
                        particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                        particle.style.width = `${Math.random() * 8 + 5}px`;
                        particle.style.height = `${Math.random() * 8 + 5}px`;
                        particle.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
                    } else if (type === 'star') {
                        particle.textContent = 'â­';
                        particle.style.fontSize = `${Math.random() * 15 + 10}px`;
                    } else if (type === 'emoji') {
                        particle.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                        particle.style.fontSize = `${Math.random() * 20 + 16}px`;
                    }

                    particlesContainer.appendChild(particle);
                    currentParticles.push(particle);
                }
            };

            /**
             * Limpa todas as partÃ­culas do DOM.
             */
            const cleanupParticles = () => {
                currentParticles.forEach(p => p.remove());
                currentParticles = [];
            };

            /**
             * Anima a contagem de pontos.
             * @param {number} targetPoints - O valor final dos pontos.
             */
            const animatePoints = (targetPoints) => {
                let startPoints = 0;
                const duration = 1000; // DuraÃ§Ã£o da animaÃ§Ã£o do contador
                let startTime = null;

                const updateCount = (currentTime) => {
                    if (!startTime) startTime = currentTime;
                    const progress = (currentTime - startTime) / duration;

                    if (progress < 1) {
                        const current = Math.floor(startPoints + (targetPoints - startPoints) * progress);
                        pointsEl.textContent = `+${current}`;
                        requestAnimationFrame(updateCount);
                    } else {
                        pointsEl.textContent = `+${targetPoints}`;
                    }
                };
                requestAnimationFrame(updateCount);
            };

            /**
             * Exibe a animaÃ§Ã£o de celebraÃ§Ã£o.
             * @param {string} message - Mensagem de celebraÃ§Ã£o.
             * @param {number} points - Pontos ganhos.
             * @param {string} type - Tipo de celebraÃ§Ã£o ('points', 'badge', 'milestone', 'confetti', 'stars', 'emojis').
             * @param {number} [duration=animationDuration] - DuraÃ§Ã£o da exibiÃ§Ã£o da celebraÃ§Ã£o.
             */
            const show = (message, points, type, duration = animationDuration) => {
                clearTimeout(animationTimeout); // Limpa qualquer animaÃ§Ã£o anterior
                cleanupParticles(); // Remove partÃ­culas antigas

                messageEl.textContent = message;
                pointsEl.textContent = `+${points}`;
                overlay.classList.add('active');

                // Cria partÃ­culas baseadas no tipo
                let particleType = 'confetti';
                let particleCount = 100;
                if (type === 'badge') {
                    particleType = 'star';
                    particleCount = 70;
                } else if (type === 'milestone') {
                    particleType = 'emoji';
                    particleCount = 80;
                } else if (type === 'stars') {
                    particleType = 'star';
                    particleCount = 120;
                } else if (type === 'emojis') {
                    particleType = 'emoji';
                    particleCount = 100;
                } else if (type === 'confetti') {
                    particleType = 'confetti';
                    particleCount = 150;
                }
                createParticles(particleType, particleCount);

                animatePoints(points);
                playSound(type);
                vibrate();

                animationTimeout = setTimeout(hide, duration);
            };

            /**
             * Esconde a animaÃ§Ã£o de celebraÃ§Ã£o.
             */
            const hide = () => {
                overlay.classList.remove('active');
                cleanupParticles();
            };

            /**
             * Exibe o modal de milestone.
             * @param {string} title - TÃ­tulo do modal.
             * @param {string} description - DescriÃ§Ã£o do milestone.
             * @param {number} points - Pontos do milestone.
             */
            const showMilestoneModal = (title, description, points) => {
                milestoneModalTitle.textContent = title;
                milestoneModalDescription.textContent = description;
                milestoneModalPoints.textContent = `${points} Pontos!`;
                milestoneModal.classList.add('active');
                // Adiciona um listener temporÃ¡rio para fechar o modal
                closeMilestoneModalBtn.onclick = hideMilestoneModal;
            };

            /**
             * Esconde o modal de milestone.
             */
            const hideMilestoneModal = () => {
                milestoneModal.classList.remove('active');
                closeMilestoneModalBtn.onclick = null; // Remove o listener
            };

            return {
                show,
                showMilestoneModal,
                hideMilestoneModal
            };
        })();

        // --- 4. CelebrationDispatcher Module ---
        // Mapeia eventos de gamificaÃ§Ã£o para tipos de celebraÃ§Ã£o e coordena a CelebrationAnimation.
        const CelebrationDispatcher = (() => {
            /**
             * Inicializa o dispatcher, subscrevendo aos eventos do GamificationManager.
             */
            const init = () => {
                GamificationManager.addEventListener('pointsEarned', handlePointsEarned);
                GamificationManager.addEventListener('badgeUnlocked', handleBadgeUnlocked);
                GamificationManager.addEventListener('milestoneAchieved', handleMilestoneAchieved);
                GamificationManager.addEventListener('dailyChallengeCompleted', handleDailyChallengeCompleted);
                GamificationManager.addEventListener('gameReset', handleGameReset);
            };

            /**
             * Manipula o evento de pontos ganhos.
             * @param {CustomEvent} event - Evento 'pointsEarned'.
             */
            const handlePointsEarned = (event) => {
                const { points } = event.detail;
                if (points > 0) {
                    CelebrationAnimation.show('âœ¨ Pontos Ganhos!', points, 'points');
                }
            };

            /**
             * Manipula o evento de badge desbloqueado.
             * @param {CustomEvent} event - Evento 'badgeUnlocked'.
             */
            const handleBadgeUnlocked = (event) => {
                const { badgeName, celebrationType } = event.detail;
                CelebrationAnimation.show(`ðŸŽ–ï¸ Badge: ${badgeName}!`, 0, celebrationType || 'badge'); // Badges nÃ£o mostram pontos no overlay
            };

            /**
             * Manipula o evento de milestone alcanÃ§ado.
             * @param {CustomEvent} event - Evento 'milestoneAchieved'.
             */
            const handleMilestoneAchieved = (event) => {
                const { message, points, celebrationType } = event.detail;
                // Primeiro mostra a celebraÃ§Ã£o visual, depois o modal
                CelebrationAnimation.show('ðŸ† Milestone AlcanÃ§ado!', points, celebrationType || 'milestone', 2000);
                setTimeout(() => {
                    CelebrationAnimation.showMilestoneModal('ðŸŽ‰ Milestone AlcanÃ§ado!', message, points);
                }, 2000); // Mostra o modal apÃ³s a celebraÃ§Ã£o principal
            };

            /**
             * Manipula o evento de desafio diÃ¡rio completado.
             * @param {CustomEvent} event - Evento 'dailyChallengeCompleted'.
             */
            const handleDailyChallengeCompleted = (event) => {
                const { points } = event.detail;
                CelebrationAnimation.show('âœ… Desafio DiÃ¡rio Completo!', points, 'stars');
            };

            /**
             * Manipula o evento de reset do jogo.
             */
            const handleGameReset = () => {
                CelebrationAnimation.show('ðŸ”„ Jogo Reiniciado!', 0, 'confetti', 1500);
            };

            return {
                init
            };
        })();

        // --- 5. UIManager Module ---
        // Gerencia todas as atualizaÃ§Ãµes da interface do usuÃ¡rio e interaÃ§Ãµes com o DOM.
        const UIManager = (() => {
            // Elementos do DOM
            const currentPointsEl = document.getElementById('current-points');
            const currentMultiplierEl = document.getElementById('current-multiplier');
            const nextBadgeInfoEl = document.getElementById('next-badge-info');
            const nextMilestoneInfoEl = document.getElementById('next-milestone-info');
            const overallProgressBar = document.getElementById('overall-progress-bar');
            const unlockedBadgesList = document.getElementById('unlocked-badges-list');
            const dailyChallengeText = document.getElementById('daily-challenge-text');
            const completeDailyChallengeBtn = document.getElementById('complete-daily-challenge-btn');
            const nextPageBtn = document.getElementById('next-page-btn');
            const completeQuizBtn = document.getElementById('complete-quiz-btn');
            const resetGameBtn = document.getElementById('reset-game-btn');
            const showAnalyticsBtn = document.getElementById('show-analytics-btn');
            const analyticsDashboard = document.getElementById('analytics-dashboard');
            const closeAnalyticsBtn = document.getElementById('close-analytics-btn');
            const analyticsTotalPoints = document.getElementById('analytics-total-points');
            const analyticsBadgesUnlocked = document.getElementById('analytics-badges-unlocked');
            const analyticsMilestonesAchieved = document.getElementById('analytics-milestones-achieved');
            const analyticsSessionTime = document.getElementById('analytics-session-time');
            const analyticsMostCelebrated = document.getElementById('analytics-most-celebrated');
            const exportAnalyticsBtn = document.getElementById('export-analytics-btn');
            const pageTitleEl = document.getElementById('page-title');
            const pageTextEl = document.getElementById('page-text');

            // ConteÃºdo das pÃ¡ginas
            const pages = [
                {
                    title: "PÃ¡gina Inicial: IntroduÃ§Ã£o",
                    text: "Bem-vindo ao nosso projeto educacional sobre vÃ­cios digitais e os novos padrÃµes comportamentais da sociedade. Aqui, exploraremos como empresas utilizam mecanismos psicolÃ³gicos sofisticados para manter os usuÃ¡rios engajados, muitas vezes sem que percebam. Navegue pelas seÃ§Ãµes para entender o sistema dopaminÃ©rgico, os mecanismos psicolÃ³gicos e as ferramentas de estimulaÃ§Ã£o que moldam nossa interaÃ§Ã£o com a tecnologia. Ao explorar o site, vocÃª ganharÃ¡ pontos e desbloquearÃ¡ badges, demonstrando como a gamificaÃ§Ã£o funciona na prÃ¡tica.",
                    points: 10,
                    nextBtnText: "Explorar Sistema DopaminÃ©rgico (Ganhe Pontos!)"
                },
                {
                    title: "Sistema DopaminÃ©rgico",
                    text: "O sistema dopaminÃ©rgico Ã© uma rede de neurÃ´nios no cÃ©rebro que utiliza a dopamina como neurotransmissor. A dopamina Ã© frequentemente associada ao prazer, mas seu papel principal Ã© na motivaÃ§Ã£o, recompensa e aprendizado. Quando realizamos uma aÃ§Ã£o que o cÃ©rebro considera benÃ©fica (como comer, socializar ou, no contexto digital, receber uma notificaÃ§Ã£o), a dopamina Ã© liberada, reforÃ§ando esse comportamento. Empresas de tecnologia exploram esse sistema criando ciclos de recompensa imprevisÃ­veis, que mantÃªm o usuÃ¡rio em busca da prÃ³xima 'dose' de dopamina.",
                    points: 20,
                    nextBtnText: "Descobrir Mecanismos PsicolÃ³gicos (Ganhe Pontos!)"
                },
                {
                    title: "Mecanismos PsicolÃ³gicos",
                    text: "Empresas utilizam diversos mecanismos psicolÃ³gicos para manter o engajamento. O 'Fear Of Missing Out' (FOMO) nos impulsiona a verificar constantemente as redes sociais. Recompensas variÃ¡veis e imprevisÃ­veis (como o nÃºmero de likes ou a prÃ³xima postagem interessante) ativam o sistema dopaminÃ©rgico de forma poderosa, criando um ciclo de busca. A prova social nos leva a seguir o comportamento da maioria, e a reciprocidade nos faz sentir a necessidade de retribuir. Esses mecanismos sÃ£o projetados para criar hÃ¡bitos e dependÃªncia.",
                    points: 25,
                    nextBtnText: "Ver Ferramentas de EstimulaÃ§Ã£o (Ganhe Pontos!)"
                },
                {
                    title: "Ferramentas de EstimulaÃ§Ã£o",
                    text: "As plataformas digitais sÃ£o repletas de ferramentas que estimulam o engajamento. NotificaÃ§Ãµes push, o 'infinite scroll' (rolagem infinita) que elimina pontos de parada, e os 'dark patterns' (interfaces que induzem a aÃ§Ãµes nÃ£o intencionais) sÃ£o exemplos. A personalizaÃ§Ã£o de conteÃºdo e algoritmos que nos mostram exatamente o que queremos ver criam bolhas de informaÃ§Ã£o que nos mantÃªm presos, enquanto a facilidade de acesso e a onipresenÃ§a dos dispositivos tornam a fuga desses estÃ­mulos cada vez mais difÃ­cil.",
                    points: 30,
                    nextBtnText: "Entender a GamificaÃ§Ã£o (Ganhe Pontos!)"
                },
                {
                    title: "GamificaÃ§Ã£o",
                    text: "A gamificaÃ§Ã£o Ã© a aplicaÃ§Ã£o de elementos e tÃ©cnicas de design de jogos em contextos nÃ£o-jogÃ¡veis. Pontos, badges, rankings, barras de progresso e desafios sÃ£o usados para motivar e engajar usuÃ¡rios. No contexto digital, isso se traduz em 'streaks' (sequÃªncias de uso diÃ¡rio), nÃ­veis de perfil, e recompensas virtuais que nos incentivam a passar mais tempo na plataforma. Embora possa ser usada para fins positivos, a gamificaÃ§Ã£o tambÃ©m Ã© uma ferramenta poderosa para criar e manter o vÃ­cio digital.",
                    points: 35,
                    nextBtnText: "Refletir sobre ConscientizaÃ§Ã£o (Ganhe Pontos!)"
                },
                {
                    title: "ConscientizaÃ§Ã£o",
                    text: "Muitas vezes, somos influenciados por esses mecanismos sem perceber. A conscientizaÃ§Ã£o Ã© o primeiro passo para retomar o controle. Entender como nosso cÃ©rebro reage Ã  dopamina e como as empresas exploram isso nos permite fazer escolhas mais informadas sobre nosso uso da tecnologia. Promover a reflexÃ£o sobre o tempo de tela, a qualidade das interaÃ§Ãµes e o impacto na saÃºde mental Ã© crucial para desenvolver um relacionamento mais saudÃ¡vel com o mundo digital.",
                    points: 40,
                    nextBtnText: "Completar Quiz e Concluir (Ganhe Pontos e Badge!)"
                },
                {
                    title: "ConclusÃ£o",
                    text: "Chegamos ao fim da nossa jornada. Vimos como o sistema dopaminÃ©rgico Ã© fundamental para o vÃ­cio, como mecanismos psicolÃ³gicos e ferramentas sofisticadas sÃ£o empregados para nos manter engajados, e como a gamificaÃ§Ã£o amplifica esses efeitos. A chave Ã© a conscientizaÃ§Ã£o. Ao entender esses processos, podemos desenvolver estratÃ©gias para um uso mais equilibrado e intencional da tecnologia, protegendo nossa saÃºde mental e bem-estar. Obrigado por explorar este tema conosco!",
                    points: 50,
                    nextBtnText: "Voltar ao InÃ­cio" // Ãšltima pÃ¡gina, volta ao inÃ­cio
                }
            ];
            let currentPageIndex = 0;

            /**
             * Atualiza a interface do usuÃ¡rio com o estado atual do jogo.
             */
            const updateUI = () => {
                const state = GamificationManager.getState();
                const badgesConfig = GamificationManager.getBadgesConfig();
                const nextBadge = GamificationManager.getNextBadge();
                const nextMilestone = GamificationManager.getNextMilestone();
                const dailyChallenge = state.dailyChallenge;
                const dailyChallengeCfg = GamificationManager.getDailyChallengeConfig();

                currentPointsEl.textContent = state.points;
                currentMultiplierEl.textContent = `x${state.multiplier}`;

                // Badges
                unlockedBadgesList.innerHTML = '';
                badgesConfig.forEach(badge => {
                    const li = document.createElement('li');
                    li.classList.add('badge-item');
                    if (state.badges.includes(badge.id)) {
                        li.classList.add('unlocked');
                        li.innerHTML = `<span class="icon">${badge.icon}</span> ${badge.name}`;
                    } else {
                        li.innerHTML = `<span class="icon">ðŸ”’</span> ${badge.name}`;
                    }
                    unlockedBadgesList.appendChild(li);
                });

                // PrÃ³ximo Badge
                if (nextBadge) {
                    nextBadgeInfoEl.textContent = `${nextBadge.name} (${nextBadge.threshold} pontos)`;
                } else {
                    nextBadgeInfoEl.textContent = 'Todos desbloqueados!';
                }

                // PrÃ³ximo Milestone
                if (nextMilestone) {
                    nextMilestoneInfoEl.textContent = `${nextMilestone.threshold} pontos`;
                } else {
                    nextMilestoneInfoEl.textContent = 'Todos alcanÃ§ados!';
                }

                // Barra de Progresso Geral (baseado em pontos para simplificar)
                const maxPointsForProgress = 1000; // Exemplo de mÃ¡ximo para a barra
                const progressPercentage = Math.min((state.points / maxPointsForProgress) * 100, 100);
                overallProgressBar.style.width = `${progressPercentage}%`;
                overallProgressBar.setAttribute('aria-valuenow', progressPercentage.toFixed(0));

                // Desafio DiÃ¡rio
                if (dailyChallenge.completed) {
                    dailyChallengeText.textContent = 'âœ… Desafio DiÃ¡rio Completo! Volte amanhÃ£ para um novo desafio.';
                    completeDailyChallengeBtn.disabled = true;
                    completeDailyChallengeBtn.textContent = 'Desafio Completo';
                } else {
                    dailyChallengeText.textContent = `Visite ${dailyChallengeCfg.pagesToVisit - dailyChallenge.pagesVisitedToday} pÃ¡ginas para ganhar ${dailyChallengeCfg.bonusPoints} pontos bÃ´nus!`;
                    completeDailyChallengeBtn.disabled = (dailyChallenge.pagesVisitedToday < dailyChallengeCfg.pagesToVisit);
                    completeDailyChallengeBtn.textContent = 'Completar Desafio DiÃ¡rio';
                }

                // BotÃ£o de Quiz (aparece na pÃ¡gina de ConscientizaÃ§Ã£o)
                if (currentPageIndex === pages.length - 2) { // PÃ¡gina de ConscientizaÃ§Ã£o
                    completeQuizBtn.style.display = 'block';
                    nextPageBtn.style.display = 'none';
                } else if (currentPageIndex === pages.length - 1) { // PÃ¡gina de ConclusÃ£o
                    completeQuizBtn.style.display = 'none';
                    nextPageBtn.style.display = 'block';
                    nextPageBtn.textContent = pages[currentPageIndex].nextBtnText;
                } else {
                    completeQuizBtn.style.display = 'none';
                    nextPageBtn.style.display = 'block';
                    nextPageBtn.textContent = pages[currentPageIndex].nextBtnText;
                }
            };

            /**
             * Carrega o conteÃºdo da pÃ¡gina atual.
             */
            const loadPageContent = () => {
                const page = pages[currentPageIndex];
                pageTitleEl.textContent = page.title;
                pageTextEl.textContent = page.text;
                nextPageBtn.textContent = page.nextBtnText;
                updateUI(); // Atualiza UI apÃ³s carregar a pÃ¡gina
            };

            /**
             * Navega para a prÃ³xima pÃ¡gina, adicionando pontos e registrando visita.
             */
            const navigateNextPage = () => {
                if (currentPageIndex < pages.length - 1) {
                    currentPageIndex++;
                    GamificationManager.addPoints(pages[currentPageIndex - 1].points); // Adiciona pontos da pÃ¡gina ANTERIOR
                    GamificationManager.incrementDailyPagesVisited();
                } else {
                    // Ãšltima pÃ¡gina, volta para a primeira
                    currentPageIndex = 0;
                }
                loadPageContent();
                AnalyticsTracker.track('pageVisited', { pageIndex: currentPageIndex, pageTitle: pages[currentPageIndex].title });
            };

            /**
             * Simula a conclusÃ£o de um quiz.
             */
            const completeQuiz = () => {
                const quizPoints = 100;
                GamificationManager.addPoints(quizPoints);
                GamificationManager.unlockBadge('quiz_master');
                AnalyticsTracker.track('quizCompleted', { points: quizPoints });
                alert('ParabÃ©ns! VocÃª completou o quiz e ganhou 100 pontos e o badge Mestre do Quiz!');
                // ApÃ³s o quiz, avanÃ§a para a pÃ¡gina de conclusÃ£o
                currentPageIndex++;
                loadPageContent();
            };

            /**
             * Atualiza o dashboard de analytics.
             */
            const updateAnalyticsDashboard = () => {
                const metrics = AnalyticsTracker.getMetrics();
                analyticsTotalPoints.textContent = metrics.totalPoints;
                analyticsBadgesUnlocked.textContent = `${metrics.badgesUnlocked} / ${GamificationManager.getBadgesConfig().length}`;
                analyticsMilestonesAchieved.textContent = `${metrics.milestonesAchieved} / ${GamificationManager.milestonesConfig.length}`;
                analyticsSessionTime.textContent = `${metrics.sessionDuration}s`;

                analyticsMostCelebrated.innerHTML = '';
                if (metrics.mostCelebrated.length > 0) {
                    metrics.mostCelebrated.forEach(item => {
                        const li = document.createElement('li');
                        li.textContent = item;
                        analyticsMostCelebrated.appendChild(li);
                    });
                } else {
                    const li = document.createElement('li');
                    li.textContent = 'Nenhum evento registrado ainda.';
                    analyticsMostCelebrated.appendChild(li);
                }
            };

            /**
             * Alterna a visibilidade do dashboard de analytics.
             */
            const toggleAnalyticsDashboard = () => {
                analyticsDashboard.classList.toggle('active');
                if (analyticsDashboard.classList.contains('active')) {
                    updateAnalyticsDashboard(); // Atualiza ao abrir
                }
            };

            /**
             * Exporta os dados de analytics como um arquivo JSON.
             */
            const exportAnalyticsData = () => {
                const dataStr = AnalyticsTracker.exportData();
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                const exportFileDefaultName = 'gamification_analytics.json';

                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                AnalyticsTracker.track('analyticsExported');
                alert('Dados de analytics exportados com sucesso!');
            };

            /**
             * Inicializa todos os listeners de eventos da UI.
             */
            const setupEventListeners = () => {
                nextPageBtn.addEventListener('click', navigateNextPage);
                completeQuizBtn.addEventListener('click', completeQuiz);
                completeDailyChallengeBtn.addEventListener('click', GamificationManager.completeDailyChallenge);
                resetGameBtn.addEventListener('click', GamificationManager.resetGame);
                showAnalyticsBtn.addEventListener('click', toggleAnalyticsDashboard);
                closeAnalyticsBtn.addEventListener('click', toggleAnalyticsDashboard);
                exportAnalyticsBtn.addEventListener('click', exportAnalyticsData);

                // Listeners para eventos do GamificationManager para atualizar a UI
                GamificationManager.addEventListener('pointsEarned', updateUI);
                GamificationManager.addEventListener('badgeUnlocked', updateUI);
                GamificationManager.addEventListener('milestoneAchieved', updateUI);
                GamificationManager.addEventListener('dailyProgress', updateUI);
                GamificationManager.addEventListener('dailyChallengeReady', updateUI);
                GamificationManager.addEventListener('dailyChallengeCompleted', updateUI);
                GamificationManager.addEventListener('gameReset', updateUI);
            };

            /**
             * Inicializa o UIManager.
             */
            const init = () => {
                loadPageContent();
                setupEventListeners();
                updateUI(); // Garante que a UI esteja atualizada no carregamento
            };

            return {
                init
            };
        })();

        // ====================================================================================================
        // INICIALIZAÃ‡ÃƒO GERAL
        // ====================================================================================================
        document.addEventListener('DOMContentLoaded', () => {
            GamificationManager.init(); // Carrega o estado do jogo
            CelebrationDispatcher.init(); // Configura o dispatcher de celebraÃ§Ãµes
            UIManager.init(); // Inicializa a interface do usuÃ¡rio
        });
    </script>
</body>
</html>